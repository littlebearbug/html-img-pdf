"use strict";var x=Object.defineProperty;var R=Object.getOwnPropertyDescriptor;var k=Object.getOwnPropertyNames;var N=Object.prototype.hasOwnProperty;var $=(t,n)=>{for(var r in n)x(t,r,{get:n[r],enumerable:!0})},F=(t,n,r,o)=>{if(n&&typeof n=="object"||typeof n=="function")for(let e of k(n))!N.call(t,e)&&e!==r&&x(t,e,{get:()=>n[e],enumerable:!(o=R(n,e))||o.enumerable});return t};var O=t=>F(x({},"__esModule",{value:!0}),t);var V={};$(V,{htmlToPdf:()=>_});module.exports=O(V);var T=require("jspdf");function D(t,n){let r=t.querySelectorAll("input, textarea"),o=n.querySelectorAll("input, textarea");r.forEach((l,f)=>{let c=o[f];c&&(l.tagName==="TEXTAREA"?(c.innerHTML=l.value,c.value=l.value):(c.setAttribute("value",l.value),c.value=l.value))});let e=t.querySelectorAll("select"),p=n.querySelectorAll("select");e.forEach((l,f)=>{let c=p[f];if(c){c.value=l.value;let d=c.querySelector(`option[value="${l.value}"]`);d&&d.setAttribute("selected","true")}});let i=t.querySelectorAll("input[type=checkbox], input[type=radio]"),a=n.querySelectorAll("input[type=checkbox], input[type=radio]"),u=Math.random().toString(36).substring(7);i.forEach((l,f)=>{let c=a[f],d=l;c&&(d.type==="radio"&&d.name&&(c.name=`${d.name}__pdf_${u}`),c.checked=d.checked,d.checked&&c.setAttribute("checked","checked"))})}function U(t,n){let r=t.querySelectorAll("canvas"),o=n.querySelectorAll("canvas");r.forEach((e,p)=>{let i=o[p];if(i)try{if(e.width>0&&e.height>0){i.width=e.width,i.height=e.height;let a=i.getContext("2d");a&&a.drawImage(e,0,0)}}catch(a){console.warn("[html-img-pdf] Failed to copy canvas:",a)}})}function W(t,n){let r=t.querySelectorAll("video"),o=n.querySelectorAll("video");r.forEach((e,p)=>{let i=o[p];if(i&&!(e.readyState<2))try{let a=document.createElement("canvas");a.width=e.videoWidth||e.clientWidth,a.height=e.videoHeight||e.clientHeight;let u=a.getContext("2d");if(u){u.drawImage(e,0,0,a.width,a.height);let l=document.createElement("img");l.src=a.toDataURL("image/png"),l.style.cssText="width:100%; height:100%; object-fit:contain;",i.parentNode&&i.parentNode.replaceChild(l,i)}}catch{}})}function j(t){t.querySelectorAll("*").forEach(r=>{let o=window.getComputedStyle(r);if(["auto","scroll"].includes(o.overflowY)||["auto","scroll"].includes(o.overflow)){let e=r;e.style.setProperty("overflow","visible","important"),e.style.setProperty("overflow-y","visible","important"),e.style.setProperty("height","auto","important"),e.style.setProperty("max-height","none","important")}})}function b(t,n){let r=document.createElement("div"),o=window.getComputedStyle(document.body);r.style.cssText=`
    position: absolute; 
    top: -10000px; 
    left: -10000px;
    opacity: 0;
    pointer-events: none;
    width: ${t.clientWidth}px; 
    font-family: ${o.fontFamily};
    font-size: ${o.fontSize};
    color: ${o.color};
    line-height: ${o.lineHeight};
    text-align: ${o.textAlign};
    z-index: -999999;
  `;let e=t.cloneNode(!0);r.appendChild(e),document.body.appendChild(r);try{D(t,e),U(t,e),W(t,e),j(e),n&&n(e)}catch(p){console.error("[html-img-pdf] Clone enhancement error:",p)}return{sandbox:r,clone:e}}function L(t){document.body.contains(t)&&document.body.removeChild(t)}async function C(t){try{await document.fonts.ready}catch{}let r=Array.from(t.querySelectorAll("img")).map(o=>(o.getAttribute("loading")==="lazy"&&o.setAttribute("loading","eager"),o.complete||!o.src?Promise.resolve():new Promise(e=>{o.onload=()=>e(),o.onerror=()=>e(),setTimeout(()=>e(),2e3)})));await Promise.all(r),await new Promise(o=>setTimeout(o,100))}var y=require("html-to-image"),S=15e3;async function A(t,n){let{format:r,quality:o,backgroundColor:e,pixelRatio:p}=n,i=t.offsetWidth,a=t.offsetHeight;if(i===0||a===0)return null;if(i>S||a>S)return console.error(`[html-img-pdf] Element too large (${i}x${a}). Skipped to prevent crash.`),null;let u={quality:o,backgroundColor:e,pixelRatio:p,width:i,height:a,cacheBust:!0,style:{margin:"0",transform:"none"}};try{let l;try{r==="png"?l=await(0,y.toPng)(t,u):l=await(0,y.toJpeg)(t,u)}catch(f){if(p>1)console.warn("[html-img-pdf] High-res capture failed, retrying with 1x ratio..."),u.pixelRatio=1,r==="png"?l=await(0,y.toPng)(t,u):l=await(0,y.toJpeg)(t,u);else throw f}return{dataUrl:l,width:i,height:a}}catch(l){return console.error("[html-img-pdf] Capture failed:",l),null}}async function z(t,n){let r=[];for(let o=0;o<t.length;o+=n){let e=t.slice(o,o+n),p=await Promise.all(e.map(i=>i()));r.push(...p)}return r}async function _(t,n={}){let{fileName:r="document.pdf",imageFormat:o="png",quality:e=.95,backgroundColor:p="#ffffff",pageSize:i="auto",pageOrientation:a,multipage:u=!1,pixelRatio:l=window.devicePixelRatio||2,concurrency:f=3,onClone:c}=n,{sandbox:d,clone:w}=b(t,c);try{await C(w);let h=[];u?(h=Array.from(w.children).filter(s=>s.nodeType===Node.ELEMENT_NODE),h.length===0&&(h=[w])):h=[w];let P=h.map(s=>()=>A(s,{format:o,quality:e,backgroundColor:p,pixelRatio:l})),v=(await z(P,f)).filter(s=>s!==null);if(v.length===0)return console.warn("[html-img-pdf] No content captured."),new T.jsPDF;let m=null;for(let s of v)if(i==="auto"){let E=a==="portrait"||a==="landscape"?a==="portrait"?"p":"l":s.width>s.height?"l":"p",g=[s.width,s.height];m?m.addPage(g,E):m=new T.jsPDF({orientation:E,unit:"px",format:g}),m.addImage(s.dataUrl,o.toUpperCase(),0,0,s.width,s.height)}else{let E=a||"portrait",g;E==="auto"?g=s.width>s.height?"l":"p":g=E==="landscape"?"l":"p";let H=typeof i=="string"?i:[i.width,i.height];m?m.addPage(H,g):m=new T.jsPDF({orientation:g,unit:"pt",format:H});let M=m.internal.pageSize.getWidth(),q=M/s.width,I=s.height*q;m.addImage(s.dataUrl,o.toUpperCase(),0,0,M,I)}return m.save(r),m}catch(h){throw console.error("[html-img-pdf] Export failed:",h),h}finally{L(d)}}0&&(module.exports={htmlToPdf});
//# sourceMappingURL=index.js.map