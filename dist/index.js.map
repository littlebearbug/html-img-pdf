{"version":3,"sources":["../src/index.ts","../src/utils/clone-utils.ts","../src/utils/resource-utils.ts","../src/utils/capture-utils.ts"],"sourcesContent":["import type { jsPDF } from \"jspdf\";\r\nimport type { Options, CaptureResult } from \"./types\";\r\nimport { createEnhancedClone, destroySandbox } from \"./utils/clone-utils\";\r\nimport { waitForResources } from \"./utils/resource-utils\";\r\nimport { captureElement } from \"./utils/capture-utils\";\r\n\r\nexport * from \"./types\";\r\n\r\nasync function runBatches<T>(\r\n  tasks: (() => Promise<T>)[],\r\n  batchSize: number,\r\n  onProgress?: (val: number, current: number, total: number) => void\r\n): Promise<T[]> {\r\n  const results: T[] = [];\r\n  const total = tasks.length;\r\n  let completed = 0;\r\n\r\n  for (let i = 0; i < total; i += batchSize) {\r\n    const batch = tasks.slice(i, i + batchSize);\r\n    const batchResults = await Promise.all(batch.map((task) => task()));\r\n    results.push(...batchResults);\r\n\r\n    completed += batch.length;\r\n    if (onProgress) {\r\n      onProgress(Math.round((completed / total) * 100), completed, total);\r\n    }\r\n  }\r\n  return results;\r\n}\r\n\r\nexport async function htmlToPdf(\r\n  element: HTMLElement,\r\n  options: Options = {}\r\n): Promise<jsPDF> {\r\n  const {\r\n    fileName = \"document.pdf\",\r\n    imageFormat = \"png\",\r\n    quality = 0.95,\r\n    backgroundColor = \"#ffffff\",\r\n    pageSize = \"auto\",\r\n    pageOrientation,\r\n    multipage = false,\r\n    pixelRatio = window.devicePixelRatio || 2,\r\n    concurrency = 3,\r\n    debug = false, // 新增\r\n    autoScroll = true, // 新增\r\n    onClone,\r\n    onProgress,\r\n    resourceTimeout = 2000,\r\n    ignoreElements,\r\n  } = options;\r\n\r\n  // 传入新的配置项到 Clone 工具\r\n  const { sandbox, clone } = createEnhancedClone(element, {\r\n    onClone,\r\n    autoScroll,\r\n    debug,\r\n  });\r\n\r\n  try {\r\n    await waitForResources(clone, resourceTimeout);\r\n\r\n    let targetElements: HTMLElement[] = [];\r\n    if (multipage) {\r\n      targetElements = Array.from(clone.children).filter(\r\n        (node) => node.nodeType === Node.ELEMENT_NODE\r\n      ) as HTMLElement[];\r\n      if (targetElements.length === 0) targetElements = [clone];\r\n    } else {\r\n      targetElements = [clone];\r\n    }\r\n\r\n    const captureTasks = targetElements.map(\r\n      (target) => () =>\r\n        captureElement(target, {\r\n          format: imageFormat,\r\n          quality,\r\n          backgroundColor,\r\n          pixelRatio,\r\n          ignoreElements,\r\n        })\r\n    );\r\n\r\n    const results = await runBatches(captureTasks, concurrency, onProgress);\r\n    const validResults = results.filter((r): r is CaptureResult => r !== null);\r\n\r\n    // 动态导入 jsPDF\r\n    const { jsPDF } = await import(\"jspdf\");\r\n\r\n    if (validResults.length === 0) {\r\n      console.warn(\"[html-img-pdf] No content captured.\");\r\n      return new jsPDF();\r\n    }\r\n\r\n    let pdf: jsPDF | null = null;\r\n\r\n    for (const imgData of validResults) {\r\n      if (pageSize === \"auto\") {\r\n        const orientation =\r\n          pageOrientation === \"portrait\" || pageOrientation === \"landscape\"\r\n            ? pageOrientation === \"portrait\"\r\n              ? \"p\"\r\n              : \"l\"\r\n            : imgData.width > imgData.height\r\n            ? \"l\"\r\n            : \"p\";\r\n\r\n        const format = [imgData.width, imgData.height];\r\n        if (!pdf) {\r\n          pdf = new jsPDF({ orientation, unit: \"px\", format });\r\n        } else {\r\n          pdf.addPage(format, orientation);\r\n        }\r\n        pdf.addImage(\r\n          imgData.dataUrl,\r\n          imageFormat.toUpperCase(),\r\n          0,\r\n          0,\r\n          imgData.width,\r\n          imgData.height\r\n        );\r\n      } else {\r\n        const userOrientation = pageOrientation || \"portrait\";\r\n        let orientation: \"p\" | \"l\";\r\n        if (userOrientation === \"auto\") {\r\n          orientation = imgData.width > imgData.height ? \"l\" : \"p\";\r\n        } else {\r\n          orientation = userOrientation === \"landscape\" ? \"l\" : \"p\";\r\n        }\r\n\r\n        let targetFormat =\r\n          typeof pageSize === \"string\"\r\n            ? pageSize\r\n            : [pageSize.width, pageSize.height];\r\n\r\n        if (!pdf) {\r\n          // @ts-ignore\r\n          pdf = new jsPDF({ orientation, unit: \"pt\", format: targetFormat });\r\n        } else {\r\n          // @ts-ignore\r\n          pdf.addPage(targetFormat, orientation);\r\n        }\r\n\r\n        const pdfPageWidth = pdf.internal.pageSize.getWidth();\r\n        const ratio = pdfPageWidth / imgData.width;\r\n        const scaledHeight = imgData.height * ratio;\r\n\r\n        pdf.addImage(\r\n          imgData.dataUrl,\r\n          imageFormat.toUpperCase(),\r\n          0,\r\n          0,\r\n          pdfPageWidth,\r\n          scaledHeight\r\n        );\r\n      }\r\n    }\r\n\r\n    if (!pdf) {\r\n      throw new Error(\"PDF generation failed: No pages rendered.\");\r\n    }\r\n\r\n    if (!debug) {\r\n      pdf.save(fileName);\r\n    } else {\r\n      console.log(\r\n        \"[html-img-pdf] Debug mode: PDF generated but not saved. Check the sandbox on screen.\"\r\n      );\r\n      // 在 debug 模式下，也可以选择 save，看你需求，通常保留 save 方便对比\r\n      // pdf.save(\"debug-\" + fileName);\r\n    }\r\n\r\n    return pdf;\r\n  } catch (err) {\r\n    console.error(\"[html-img-pdf] Export failed:\", err);\r\n    throw err;\r\n  } finally {\r\n    // Debug 模式下不销毁沙箱\r\n    if (!debug) {\r\n      destroySandbox(sandbox);\r\n    }\r\n  }\r\n}\r\n","import type { Options } from \"../types\";\r\n\r\n/**\r\n * 深度同步 Form 状态并解决 Radio 冲突\r\n */\r\nexport function syncFormStates(source: HTMLElement, clone: HTMLElement) {\r\n  // 1. Text Inputs & Textarea\r\n  const srcInputs = source.querySelectorAll(\"input, textarea\");\r\n  const cloneInputs = clone.querySelectorAll(\"input, textarea\");\r\n\r\n  srcInputs.forEach((src, i) => {\r\n    const dst = cloneInputs[i] as HTMLInputElement | HTMLTextAreaElement;\r\n    if (!dst) return;\r\n\r\n    // 必须显式设置 attribute，否则 html-to-image 可能会遗漏\r\n    if (src.tagName === \"TEXTAREA\") {\r\n      dst.innerHTML = (src as HTMLTextAreaElement).value;\r\n      dst.value = (src as HTMLTextAreaElement).value;\r\n    } else {\r\n      dst.setAttribute(\"value\", (src as HTMLInputElement).value);\r\n      dst.value = (src as HTMLInputElement).value;\r\n    }\r\n  });\r\n\r\n  // 2. Select\r\n  const srcSelects = source.querySelectorAll(\"select\");\r\n  const cloneSelects = clone.querySelectorAll(\"select\");\r\n  srcSelects.forEach((src, i) => {\r\n    const dst = cloneSelects[i];\r\n    if (dst) {\r\n      dst.value = src.value;\r\n      const option = dst.querySelector(`option[value=\"${src.value}\"]`);\r\n      if (option) option.setAttribute(\"selected\", \"true\");\r\n    }\r\n  });\r\n\r\n  // 3. Checkbox & Radio (关键修复：Radio Name Isolation)\r\n  const srcChecks = source.querySelectorAll(\r\n    \"input[type=checkbox], input[type=radio]\"\r\n  );\r\n  const cloneChecks = clone.querySelectorAll(\r\n    \"input[type=checkbox], input[type=radio]\"\r\n  );\r\n\r\n  // 生成一个随机后缀，防止克隆的 radio 组与原始页面冲突\r\n  const uniqueSuffix = Math.random().toString(36).substring(7);\r\n\r\n  srcChecks.forEach((src, i) => {\r\n    const dst = cloneChecks[i] as HTMLInputElement;\r\n    const srcInput = src as HTMLInputElement;\r\n\r\n    if (!dst) return;\r\n\r\n    if (srcInput.type === \"radio\" && srcInput.name) {\r\n      // 修改 name，使克隆的 radio 形成独立的组\r\n      dst.name = `${srcInput.name}__pdf_${uniqueSuffix}`;\r\n    }\r\n\r\n    dst.checked = srcInput.checked;\r\n    if (srcInput.checked) {\r\n      dst.setAttribute(\"checked\", \"checked\");\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * 复制 Canvas (修复：增加容错)\r\n */\r\nexport function copyCanvasContent(source: HTMLElement, clone: HTMLElement) {\r\n  const srcCanvases = source.querySelectorAll(\"canvas\");\r\n  const cloneCanvases = clone.querySelectorAll(\"canvas\");\r\n\r\n  srcCanvases.forEach((src, i) => {\r\n    const dst = cloneCanvases[i];\r\n    if (!dst) return;\r\n\r\n    try {\r\n      // 避免宽高为 0 导致报错\r\n      if (src.width > 0 && src.height > 0) {\r\n        dst.width = src.width;\r\n        dst.height = src.height;\r\n        const ctx = dst.getContext(\"2d\");\r\n        if (ctx) ctx.drawImage(src, 0, 0);\r\n      }\r\n    } catch (e) {\r\n      console.warn(\"[html-img-pdf] Failed to copy canvas:\", e);\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * 视频转图片 (修复：检查 readyState)\r\n */\r\nexport function convertVideoToImage(source: HTMLElement, clone: HTMLElement) {\r\n  const srcVideos = source.querySelectorAll(\"video\");\r\n  const cloneVideos = clone.querySelectorAll(\"video\");\r\n\r\n  srcVideos.forEach((video, i) => {\r\n    const cloneVideo = cloneVideos[i];\r\n    if (!cloneVideo) return;\r\n\r\n    // 如果视频没加载数据，直接跳过\r\n    if (video.readyState < 2) return;\r\n\r\n    try {\r\n      const canvas = document.createElement(\"canvas\");\r\n      canvas.width = video.videoWidth || video.clientWidth;\r\n      canvas.height = video.videoHeight || video.clientHeight;\r\n      const ctx = canvas.getContext(\"2d\");\r\n\r\n      if (ctx) {\r\n        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);\r\n        const img = document.createElement(\"img\");\r\n        img.src = canvas.toDataURL(\"image/png\");\r\n        img.style.cssText = \"width:100%; object-fit:contain;\";\r\n\r\n        if (cloneVideo.parentNode) {\r\n          cloneVideo.parentNode.replaceChild(img, cloneVideo);\r\n        }\r\n      }\r\n    } catch (e) {\r\n      // 跨域视频可能会导致 tainted canvas，忽略错误\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * 滚动展开 (修复：处理 max-height)\r\n */\r\nexport function expandScrollableElements(clone: HTMLElement) {\r\n  const elements = clone.querySelectorAll(\"*\");\r\n  elements.forEach((el) => {\r\n    const style = window.getComputedStyle(el);\r\n    if (\r\n      [\"auto\", \"scroll\"].includes(style.overflowY) ||\r\n      [\"auto\", \"scroll\"].includes(style.overflow)\r\n    ) {\r\n      const element = el as HTMLElement;\r\n      element.style.setProperty(\"overflow\", \"visible\", \"important\");\r\n      element.style.setProperty(\"overflow-y\", \"visible\", \"important\");\r\n      element.style.setProperty(\"height\", \"auto\", \"important\");\r\n      element.style.setProperty(\"max-height\", \"none\", \"important\"); // 关键修复\r\n    }\r\n  });\r\n}\r\n\r\nexport function createEnhancedClone(\r\n  source: HTMLElement,\r\n  options: {\r\n    onClone?: Options[\"onClone\"];\r\n    autoScroll?: boolean;\r\n    debug?: boolean;\r\n  }\r\n): { sandbox: HTMLElement; clone: HTMLElement } {\r\n  const { onClone, autoScroll = true, debug = false } = options;\r\n\r\n  const sandbox = document.createElement(\"div\");\r\n  const bodyStyle = window.getComputedStyle(document.body);\r\n\r\n  // 基础样式\r\n  let sandboxCss = `\r\n    position: fixed; \r\n    width: ${source.clientWidth}px; \r\n    font-family: ${bodyStyle.fontFamily};\r\n    font-size: ${bodyStyle.fontSize};\r\n    color: ${bodyStyle.color};\r\n    line-height: ${bodyStyle.lineHeight};\r\n    text-align: ${bodyStyle.textAlign};\r\n  `;\r\n\r\n  if (debug) {\r\n    // DEBUG 模式：显示在页面左上角，加红框\r\n    console.log(\"[html-img-pdf] Debug mode active: Sandbox is visible.\");\r\n    sandboxCss += `\r\n        top: 20px;\r\n        left: 20px;\r\n        z-index: 99999;\r\n        background: rgba(255, 255, 255, 0.95);\r\n        border: 5px solid red;\r\n        box-shadow: 0 0 20px rgba(0,0,0,0.5);\r\n        pointer-events: auto; /* 允许审查元素 */\r\n        overflow: auto;\r\n        max-height: 90vh; /* 防止太长超出屏幕 */\r\n      `;\r\n  } else {\r\n    // 正常模式：隐藏到屏幕外\r\n    sandboxCss += `\r\n        top: -10000px; \r\n        left: -10000px; \r\n        z-index: -9999;\r\n        opacity: 0;\r\n        pointer-events: none; /* 防止影响页面交互 */\r\n      `;\r\n  }\r\n\r\n  sandbox.style.cssText = sandboxCss;\r\n\r\n  // 加上一个 ID 方便开发者在 Elements 面板里找\r\n  sandbox.id = \"html-img-pdf-sandbox\";\r\n\r\n  if (debug) {\r\n    const closeBtn = document.createElement(\"button\");\r\n    closeBtn.textContent = \"✕\";\r\n    closeBtn.style.cssText = `\r\n      position: absolute;\r\n      top: 0;\r\n      right: 0;\r\n      z-index: 100000;\r\n      width: 40px;\r\n      height: 40px;\r\n      padding: 10px;\r\n      background: transparent;\r\n      color: black;\r\n      border: none;\r\n      font-weight: bold;\r\n      cursor: pointer;\r\n      text-align: center;\r\n      outline: none;\r\n    `;\r\n\r\n    // 点击销毁\r\n    closeBtn.onclick = () => destroySandbox(sandbox);\r\n\r\n    sandbox.appendChild(closeBtn);\r\n  }\r\n\r\n  const clone = source.cloneNode(true) as HTMLElement;\r\n\r\n  sandbox.appendChild(clone);\r\n  document.body.appendChild(sandbox);\r\n\r\n  try {\r\n    syncFormStates(source, clone);\r\n    copyCanvasContent(source, clone);\r\n    convertVideoToImage(source, clone);\r\n\r\n    // 只有在开启 autoScroll 时才展开\r\n    if (autoScroll) {\r\n      expandScrollableElements(clone);\r\n    }\r\n\r\n    // 增强 onClone，传入 sandbox\r\n    if (onClone) {\r\n      onClone(clone, sandbox);\r\n    }\r\n  } catch (e) {\r\n    console.error(\"[html-img-pdf] Clone enhancement error:\", e);\r\n  }\r\n\r\n  return { sandbox, clone };\r\n}\r\n\r\nexport function destroySandbox(sandbox: HTMLElement) {\r\n  if (document.body.contains(sandbox)) {\r\n    document.body.removeChild(sandbox);\r\n  }\r\n}\r\n","export async function waitForResources(\r\n  element: HTMLElement,\r\n  timeout = 2000\r\n): Promise<void> {\r\n  // 1. 字体\r\n  try {\r\n    await document.fonts.ready;\r\n  } catch (e) {\r\n    // 忽略旧浏览器错误\r\n  }\r\n\r\n  // 2. 图片\r\n  const imgs = Array.from(element.querySelectorAll(\"img\"));\r\n  const promises = imgs.map((img) => {\r\n    // 如果有 loading=\"lazy\"，将其改为 eager 以便立即加载\r\n    if (img.getAttribute(\"loading\") === \"lazy\") {\r\n      img.setAttribute(\"loading\", \"eager\");\r\n    }\r\n\r\n    if (img.complete) return Promise.resolve();\r\n    if (!img.src) return Promise.resolve();\r\n\r\n    return new Promise<void>((resolve) => {\r\n      // 成功或失败都 resolve，防止死锁\r\n      img.onload = () => resolve();\r\n      img.onerror = () => resolve();\r\n      // 超时保护\r\n      setTimeout(() => resolve(), timeout);\r\n    });\r\n  });\r\n\r\n  await Promise.all(promises);\r\n\r\n  // 3. 额外缓冲，等待布局重排\r\n  await new Promise((r) => setTimeout(r, 100));\r\n}\r\n","import type { CaptureResult, Options } from \"../types\";\r\n\r\n// 安全限制：防止生成导致浏览器崩溃的超大 Canvas\r\n// 浏览器 Canvas 安全限制 (iOS Safari 限制约为 16384px)\r\nconst MAX_CANVAS_PIXELS = 16000;\r\n\r\ninterface CaptureOptions {\r\n  format: \"jpeg\" | \"png\";\r\n  quality: number;\r\n  backgroundColor: string;\r\n  pixelRatio: number;\r\n  ignoreElements?: Options[\"ignoreElements\"];\r\n}\r\n\r\nexport async function captureElement(\r\n  element: HTMLElement,\r\n  options: CaptureOptions\r\n): Promise<CaptureResult | null> {\r\n  const { format, quality, backgroundColor, pixelRatio, ignoreElements } =\r\n    options;\r\n  const width = element.offsetWidth;\r\n  const height = element.offsetHeight;\r\n\r\n  if (width === 0 || height === 0) return null;\r\n\r\n  if (width > MAX_CANVAS_PIXELS || height > MAX_CANVAS_PIXELS) {\r\n    console.error(\r\n      `[html-img-pdf] Element too large (${width}x${height}). Skipped to prevent crash.`\r\n    );\r\n    return null;\r\n  }\r\n\r\n  // 动态导入 html-to-image\r\n  const { toPng, toJpeg } = await import(\"html-to-image\");\r\n\r\n  const libOptions = {\r\n    quality,\r\n    backgroundColor,\r\n    pixelRatio,\r\n    width,\r\n    height,\r\n    // 关键配置：尝试绕过 CORS 问题\r\n    cacheBust: true,\r\n    style: {\r\n      margin: \"0\",\r\n      transform: \"none\",\r\n    },\r\n    filter: ignoreElements,\r\n  };\r\n\r\n  try {\r\n    let dataUrl: string;\r\n    // 重试机制：如果高清截图失败（可能是 OOM），尝试降低 pixelRatio 重试\r\n    try {\r\n      if (format === \"png\") {\r\n        dataUrl = await toPng(element, libOptions);\r\n      } else {\r\n        dataUrl = await toJpeg(element, libOptions);\r\n      }\r\n    } catch (firstErr) {\r\n      if (pixelRatio > 1) {\r\n        console.warn(\r\n          \"[html-img-pdf] High-res capture failed, retrying with 1x ratio...\"\r\n        );\r\n        libOptions.pixelRatio = 1;\r\n        if (format === \"png\") {\r\n          dataUrl = await toPng(element, libOptions);\r\n        } else {\r\n          dataUrl = await toJpeg(element, libOptions);\r\n        }\r\n      } else {\r\n        throw firstErr;\r\n      }\r\n    }\r\n\r\n    return { dataUrl, width, height };\r\n  } catch (error) {\r\n    console.error(\"[html-img-pdf] Capture failed:\", error);\r\n    return null;\r\n  }\r\n}\r\n"],"mappings":"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","names":["index_exports","__export","htmlToPdf","__toCommonJS","syncFormStates","source","clone","srcInputs","cloneInputs","src","i","dst","srcSelects","cloneSelects","option","srcChecks","cloneChecks","uniqueSuffix","srcInput","copyCanvasContent","srcCanvases","cloneCanvases","ctx","e","convertVideoToImage","srcVideos","cloneVideos","video","cloneVideo","canvas","img","expandScrollableElements","el","style","element","createEnhancedClone","options","onClone","autoScroll","debug","sandbox","bodyStyle","sandboxCss","closeBtn","destroySandbox","waitForResources","element","timeout","promises","img","resolve","r","captureElement","element","options","format","quality","backgroundColor","pixelRatio","ignoreElements","width","height","toPng","toJpeg","libOptions","dataUrl","firstErr","error","runBatches","tasks","batchSize","onProgress","results","total","completed","i","batch","batchResults","task","htmlToPdf","element","options","fileName","imageFormat","quality","backgroundColor","pageSize","pageOrientation","multipage","pixelRatio","concurrency","debug","autoScroll","onClone","resourceTimeout","ignoreElements","sandbox","clone","createEnhancedClone","waitForResources","targetElements","node","captureTasks","target","captureElement","validResults","r","jsPDF","pdf","imgData","orientation","format","userOrientation","targetFormat","pdfPageWidth","ratio","scaledHeight","err","destroySandbox"]}