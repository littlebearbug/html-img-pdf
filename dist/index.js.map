{"version":3,"sources":["../src/index.ts","../src/utils/clone-utils.ts","../src/utils/resource-utils.ts","../src/utils/capture-utils.ts"],"sourcesContent":["import { jsPDF } from \"jspdf\";\r\nimport type { Options, CaptureResult } from \"./types\";\r\nimport { createEnhancedClone, destroySandbox } from \"./utils/clone-utils\";\r\nimport { waitForResources } from \"./utils/resource-utils\";\r\nimport { captureElement } from \"./utils/capture-utils\";\r\n\r\nexport * from \"./types\";\r\n\r\nasync function runBatches<T>(\r\n  tasks: (() => Promise<T>)[],\r\n  batchSize: number\r\n): Promise<T[]> {\r\n  const results: T[] = [];\r\n  for (let i = 0; i < tasks.length; i += batchSize) {\r\n    const batch = tasks.slice(i, i + batchSize);\r\n    const batchResults = await Promise.all(batch.map((task) => task()));\r\n    results.push(...batchResults);\r\n  }\r\n  return results;\r\n}\r\n\r\nexport async function htmlToPdf(\r\n  element: HTMLElement,\r\n  options: Options = {}\r\n): Promise<jsPDF> {\r\n  const {\r\n    fileName = \"document.pdf\",\r\n    imageFormat = \"png\",\r\n    quality = 0.95,\r\n    backgroundColor = \"#ffffff\",\r\n    pageSize = \"auto\",\r\n    pageOrientation,\r\n    multipage = false,\r\n    pixelRatio = window.devicePixelRatio || 2,\r\n    concurrency = 3,\r\n    onClone,\r\n  } = options;\r\n\r\n  const { sandbox, clone } = createEnhancedClone(element, onClone);\r\n\r\n  try {\r\n    await waitForResources(clone);\r\n\r\n    let targetElements: HTMLElement[] = [];\r\n    if (multipage) {\r\n      targetElements = Array.from(clone.children).filter(\r\n        (node) => node.nodeType === Node.ELEMENT_NODE\r\n      ) as HTMLElement[];\r\n      if (targetElements.length === 0) targetElements = [clone];\r\n    } else {\r\n      targetElements = [clone];\r\n    }\r\n\r\n    const captureTasks = targetElements.map(\r\n      (target) => () =>\r\n        captureElement(target, {\r\n          format: imageFormat,\r\n          quality,\r\n          backgroundColor,\r\n          pixelRatio,\r\n        })\r\n    );\r\n\r\n    const results = await runBatches(captureTasks, concurrency);\r\n    const validResults = results.filter((r): r is CaptureResult => r !== null);\r\n\r\n    if (validResults.length === 0) {\r\n      console.warn(\"[html-img-pdf] No content captured.\");\r\n      return new jsPDF();\r\n    }\r\n\r\n    let pdf: jsPDF | null = null;\r\n\r\n    for (const imgData of validResults) {\r\n      // ---------------------------------------------------------\r\n      // 场景 1: Auto Mode (完全适应图片大小)\r\n      // ---------------------------------------------------------\r\n      if (pageSize === \"auto\") {\r\n        // 在 Auto 模式下，方向默认由图片形状决定\r\n        const orientation =\r\n          pageOrientation === \"portrait\" || pageOrientation === \"landscape\"\r\n            ? pageOrientation === \"portrait\"\r\n              ? \"p\"\r\n              : \"l\"\r\n            : imgData.width > imgData.height\r\n            ? \"l\"\r\n            : \"p\";\r\n\r\n        const format = [imgData.width, imgData.height];\r\n\r\n        if (!pdf) {\r\n          pdf = new jsPDF({ orientation, unit: \"px\", format });\r\n        } else {\r\n          pdf.addPage(format, orientation);\r\n        }\r\n\r\n        // 1:1 绘制，填满页面\r\n        pdf.addImage(\r\n          imgData.dataUrl,\r\n          imageFormat.toUpperCase(),\r\n          0,\r\n          0,\r\n          imgData.width,\r\n          imgData.height\r\n        );\r\n      }\r\n\r\n      // ---------------------------------------------------------\r\n      // 场景 2: Fixed Mode (A4, Letter 等)\r\n      // ---------------------------------------------------------\r\n      else {\r\n        // 1. 确定方向：默认强制纵向 (Portrait)，除非用户显式要求 auto 或 landscape\r\n        // 这样可以保证多页 A4 文档整齐划一，不会一页横一页竖\r\n        const userOrientation = pageOrientation || \"portrait\";\r\n        let orientation: \"p\" | \"l\";\r\n\r\n        if (userOrientation === \"auto\") {\r\n          orientation = imgData.width > imgData.height ? \"l\" : \"p\";\r\n        } else {\r\n          orientation = userOrientation === \"landscape\" ? \"l\" : \"p\";\r\n        }\r\n\r\n        let targetFormat =\r\n          typeof pageSize === \"string\"\r\n            ? pageSize\r\n            : [pageSize.width, pageSize.height];\r\n\r\n        // 2. 初始化 PDF\r\n        // 使用 point (pt) 是 PDF 的标准做法，确保 \"a4\" 无论在什么屏幕 DPI 下都是标准的物理 A4 纸大小\r\n        if (!pdf) {\r\n          // @ts-ignore\r\n          pdf = new jsPDF({ orientation, unit: \"pt\", format: targetFormat });\r\n        } else {\r\n          // @ts-ignore\r\n          pdf.addPage(targetFormat, orientation);\r\n        }\r\n\r\n        const pdfPageWidth = pdf.internal.pageSize.getWidth();\r\n        // const pdfPageHeight = pdf.internal.pageSize.getHeight();\r\n\r\n        // 3. 计算缩放 (Fit Width Strategy)\r\n        // 将像素单位的图片，缩放到点单位的 PDF 页面宽度\r\n        const ratio = pdfPageWidth / imgData.width;\r\n        const scaledHeight = imgData.height * ratio;\r\n\r\n        pdf.addImage(\r\n          imgData.dataUrl,\r\n          imageFormat.toUpperCase(),\r\n          0,\r\n          0,\r\n          pdfPageWidth,\r\n          scaledHeight\r\n        );\r\n      }\r\n    }\r\n\r\n    pdf!.save(fileName);\r\n    return pdf!;\r\n  } catch (err) {\r\n    console.error(\"[html-img-pdf] Export failed:\", err);\r\n    throw err;\r\n  } finally {\r\n    destroySandbox(sandbox);\r\n  }\r\n}\r\n","/**\r\n * 深度同步 Form 状态并解决 Radio 冲突\r\n */\r\nexport function syncFormStates(source: HTMLElement, clone: HTMLElement) {\r\n  // 1. Text Inputs & Textarea\r\n  const srcInputs = source.querySelectorAll(\"input, textarea\");\r\n  const cloneInputs = clone.querySelectorAll(\"input, textarea\");\r\n\r\n  srcInputs.forEach((src, i) => {\r\n    const dst = cloneInputs[i] as HTMLInputElement | HTMLTextAreaElement;\r\n    if (!dst) return;\r\n\r\n    // 必须显式设置 attribute，否则 html-to-image 可能会遗漏\r\n    if (src.tagName === \"TEXTAREA\") {\r\n      dst.innerHTML = (src as HTMLTextAreaElement).value;\r\n      dst.value = (src as HTMLTextAreaElement).value;\r\n    } else {\r\n      dst.setAttribute(\"value\", (src as HTMLInputElement).value);\r\n      dst.value = (src as HTMLInputElement).value;\r\n    }\r\n  });\r\n\r\n  // 2. Select\r\n  const srcSelects = source.querySelectorAll(\"select\");\r\n  const cloneSelects = clone.querySelectorAll(\"select\");\r\n  srcSelects.forEach((src, i) => {\r\n    const dst = cloneSelects[i];\r\n    if (dst) {\r\n      dst.value = src.value;\r\n      const option = dst.querySelector(`option[value=\"${src.value}\"]`);\r\n      if (option) option.setAttribute(\"selected\", \"true\");\r\n    }\r\n  });\r\n\r\n  // 3. Checkbox & Radio (关键修复：Radio Name Isolation)\r\n  const srcChecks = source.querySelectorAll(\r\n    \"input[type=checkbox], input[type=radio]\"\r\n  );\r\n  const cloneChecks = clone.querySelectorAll(\r\n    \"input[type=checkbox], input[type=radio]\"\r\n  );\r\n\r\n  // 生成一个随机后缀，防止克隆的 radio 组与原始页面冲突\r\n  const uniqueSuffix = Math.random().toString(36).substring(7);\r\n\r\n  srcChecks.forEach((src, i) => {\r\n    const dst = cloneChecks[i] as HTMLInputElement;\r\n    const srcInput = src as HTMLInputElement;\r\n\r\n    if (!dst) return;\r\n\r\n    if (srcInput.type === \"radio\" && srcInput.name) {\r\n      // 修改 name，使克隆的 radio 形成独立的组\r\n      dst.name = `${srcInput.name}__pdf_${uniqueSuffix}`;\r\n    }\r\n\r\n    dst.checked = srcInput.checked;\r\n    if (srcInput.checked) {\r\n      dst.setAttribute(\"checked\", \"checked\");\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * 复制 Canvas (修复：增加容错)\r\n */\r\nexport function copyCanvasContent(source: HTMLElement, clone: HTMLElement) {\r\n  const srcCanvases = source.querySelectorAll(\"canvas\");\r\n  const cloneCanvases = clone.querySelectorAll(\"canvas\");\r\n\r\n  srcCanvases.forEach((src, i) => {\r\n    const dst = cloneCanvases[i];\r\n    if (!dst) return;\r\n\r\n    try {\r\n      // 避免宽高为 0 导致报错\r\n      if (src.width > 0 && src.height > 0) {\r\n        dst.width = src.width;\r\n        dst.height = src.height;\r\n        const ctx = dst.getContext(\"2d\");\r\n        if (ctx) ctx.drawImage(src, 0, 0);\r\n      }\r\n    } catch (e) {\r\n      console.warn(\"[html-img-pdf] Failed to copy canvas:\", e);\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * 视频转图片 (修复：检查 readyState)\r\n */\r\nexport function convertVideoToImage(source: HTMLElement, clone: HTMLElement) {\r\n  const srcVideos = source.querySelectorAll(\"video\");\r\n  const cloneVideos = clone.querySelectorAll(\"video\");\r\n\r\n  srcVideos.forEach((video, i) => {\r\n    const cloneVideo = cloneVideos[i];\r\n    if (!cloneVideo) return;\r\n\r\n    // 如果视频没加载数据，直接跳过\r\n    if (video.readyState < 2) return;\r\n\r\n    try {\r\n      const canvas = document.createElement(\"canvas\");\r\n      canvas.width = video.videoWidth || video.clientWidth;\r\n      canvas.height = video.videoHeight || video.clientHeight;\r\n      const ctx = canvas.getContext(\"2d\");\r\n\r\n      if (ctx) {\r\n        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);\r\n        const img = document.createElement(\"img\");\r\n        img.src = canvas.toDataURL(\"image/png\");\r\n        img.style.cssText = \"width:100%; height:100%; object-fit:contain;\";\r\n\r\n        if (cloneVideo.parentNode) {\r\n          cloneVideo.parentNode.replaceChild(img, cloneVideo);\r\n        }\r\n      }\r\n    } catch (e) {\r\n      // 跨域视频可能会导致 tainted canvas，忽略错误\r\n    }\r\n  });\r\n}\r\n\r\n/**\r\n * 滚动展开 (修复：处理 max-height)\r\n */\r\nexport function expandScrollableElements(clone: HTMLElement) {\r\n  const elements = clone.querySelectorAll(\"*\");\r\n  elements.forEach((el) => {\r\n    const style = window.getComputedStyle(el);\r\n    if (\r\n      [\"auto\", \"scroll\"].includes(style.overflowY) ||\r\n      [\"auto\", \"scroll\"].includes(style.overflow)\r\n    ) {\r\n      const element = el as HTMLElement;\r\n      element.style.setProperty(\"overflow\", \"visible\", \"important\");\r\n      element.style.setProperty(\"overflow-y\", \"visible\", \"important\");\r\n      element.style.setProperty(\"height\", \"auto\", \"important\");\r\n      element.style.setProperty(\"max-height\", \"none\", \"important\"); // 关键修复\r\n    }\r\n  });\r\n}\r\n\r\nexport function createEnhancedClone(\r\n  source: HTMLElement,\r\n  onClone?: (el: HTMLElement) => void\r\n): { sandbox: HTMLElement; clone: HTMLElement } {\r\n  const sandbox = document.createElement(\"div\");\r\n\r\n  // 1. 样式隔离与上下文继承\r\n  // 复制 body 的关键样式，防止克隆体失去字体等上下文\r\n  const bodyStyle = window.getComputedStyle(document.body);\r\n  sandbox.style.cssText = `\r\n    position: absolute; \r\n    top: -10000px; \r\n    left: -10000px;\r\n    opacity: 0;\r\n    pointer-events: none;\r\n    width: ${source.clientWidth}px; \r\n    font-family: ${bodyStyle.fontFamily};\r\n    font-size: ${bodyStyle.fontSize};\r\n    color: ${bodyStyle.color};\r\n    line-height: ${bodyStyle.lineHeight};\r\n    text-align: ${bodyStyle.textAlign};\r\n    z-index: -999999;\r\n  `;\r\n\r\n  const clone = source.cloneNode(true) as HTMLElement;\r\n\r\n  sandbox.appendChild(clone);\r\n  document.body.appendChild(sandbox);\r\n\r\n  try {\r\n    syncFormStates(source, clone);\r\n    copyCanvasContent(source, clone);\r\n    convertVideoToImage(source, clone);\r\n    expandScrollableElements(clone);\r\n    if (onClone) onClone(clone);\r\n  } catch (e) {\r\n    console.error(\"[html-img-pdf] Clone enhancement error:\", e);\r\n  }\r\n\r\n  return { sandbox, clone };\r\n}\r\n\r\nexport function destroySandbox(sandbox: HTMLElement) {\r\n  if (document.body.contains(sandbox)) {\r\n    document.body.removeChild(sandbox);\r\n  }\r\n}\r\n","export async function waitForResources(element: HTMLElement): Promise<void> {\r\n  // 1. 字体\r\n  try {\r\n    await document.fonts.ready;\r\n  } catch (e) {\r\n    // 忽略旧浏览器错误\r\n  }\r\n\r\n  // 2. 图片\r\n  const imgs = Array.from(element.querySelectorAll(\"img\"));\r\n  const promises = imgs.map((img) => {\r\n    // 如果有 loading=\"lazy\"，将其改为 eager 以便立即加载\r\n    if (img.getAttribute(\"loading\") === \"lazy\") {\r\n      img.setAttribute(\"loading\", \"eager\");\r\n    }\r\n\r\n    if (img.complete) return Promise.resolve();\r\n    if (!img.src) return Promise.resolve();\r\n\r\n    return new Promise<void>((resolve) => {\r\n      // 成功或失败都 resolve，防止死锁\r\n      img.onload = () => resolve();\r\n      img.onerror = () => resolve();\r\n      // 超时保护：如果图片 2秒内没加载完，强行继续\r\n      setTimeout(() => resolve(), 2000);\r\n    });\r\n  });\r\n\r\n  await Promise.all(promises);\r\n\r\n  // 3. 额外缓冲，等待布局重排\r\n  await new Promise((r) => setTimeout(r, 100));\r\n}\r\n","import { toPng, toJpeg } from \"html-to-image\";\r\nimport type { CaptureResult } from \"../types\";\r\n\r\n// 安全限制：防止生成导致浏览器崩溃的超大 Canvas\r\n// 15000px 是 iOS Safari 的硬限制附近，保留安全余量\r\nconst MAX_DIMENSION = 15000;\r\n\r\ninterface CaptureOptions {\r\n  format: \"jpeg\" | \"png\";\r\n  quality: number;\r\n  backgroundColor: string;\r\n  pixelRatio: number;\r\n}\r\n\r\nexport async function captureElement(\r\n  element: HTMLElement,\r\n  options: CaptureOptions\r\n): Promise<CaptureResult | null> {\r\n  const { format, quality, backgroundColor, pixelRatio } = options;\r\n  const width = element.offsetWidth;\r\n  const height = element.offsetHeight;\r\n\r\n  if (width === 0 || height === 0) return null;\r\n\r\n  if (width > MAX_DIMENSION || height > MAX_DIMENSION) {\r\n    console.error(\r\n      `[html-img-pdf] Element too large (${width}x${height}). Skipped to prevent crash.`\r\n    );\r\n    return null;\r\n  }\r\n\r\n  const libOptions = {\r\n    quality,\r\n    backgroundColor,\r\n    pixelRatio,\r\n    width,\r\n    height,\r\n    // 关键配置：尝试绕过 CORS 问题\r\n    cacheBust: true,\r\n    style: {\r\n      margin: \"0\",\r\n      transform: \"none\",\r\n    },\r\n  };\r\n\r\n  try {\r\n    let dataUrl: string;\r\n    // 重试机制：如果高清截图失败（可能是 OOM），尝试降低 pixelRatio 重试\r\n    try {\r\n      if (format === \"png\") {\r\n        dataUrl = await toPng(element, libOptions);\r\n      } else {\r\n        dataUrl = await toJpeg(element, libOptions);\r\n      }\r\n    } catch (firstErr) {\r\n      if (pixelRatio > 1) {\r\n        console.warn(\r\n          \"[html-img-pdf] High-res capture failed, retrying with 1x ratio...\"\r\n        );\r\n        libOptions.pixelRatio = 1;\r\n        if (format === \"png\") {\r\n          dataUrl = await toPng(element, libOptions);\r\n        } else {\r\n          dataUrl = await toJpeg(element, libOptions);\r\n        }\r\n      } else {\r\n        throw firstErr;\r\n      }\r\n    }\r\n\r\n    return { dataUrl, width, height };\r\n  } catch (error) {\r\n    console.error(\"[html-img-pdf] Capture failed:\", error);\r\n    return null;\r\n  }\r\n}\r\n"],"mappings":"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","names":["index_exports","__export","htmlToPdf","__toCommonJS","import_jspdf","syncFormStates","source","clone","srcInputs","cloneInputs","src","i","dst","srcSelects","cloneSelects","option","srcChecks","cloneChecks","uniqueSuffix","srcInput","copyCanvasContent","srcCanvases","cloneCanvases","ctx","e","convertVideoToImage","srcVideos","cloneVideos","video","cloneVideo","canvas","img","expandScrollableElements","el","style","element","createEnhancedClone","onClone","sandbox","bodyStyle","destroySandbox","waitForResources","element","promises","img","resolve","r","import_html_to_image","MAX_DIMENSION","captureElement","element","options","format","quality","backgroundColor","pixelRatio","width","height","libOptions","dataUrl","firstErr","error","runBatches","tasks","batchSize","results","i","batch","batchResults","task","htmlToPdf","element","options","fileName","imageFormat","quality","backgroundColor","pageSize","pageOrientation","multipage","pixelRatio","concurrency","onClone","sandbox","clone","createEnhancedClone","waitForResources","targetElements","node","captureTasks","target","captureElement","validResults","r","pdf","imgData","orientation","format","userOrientation","targetFormat","pdfPageWidth","ratio","scaledHeight","err","destroySandbox"]}