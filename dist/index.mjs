import{jsPDF as w}from"jspdf";function R(o,l){let a=o.querySelectorAll("input, textarea"),t=l.querySelectorAll("input, textarea");a.forEach((i,f)=>{let c=t[f];c&&(i.tagName==="TEXTAREA"?(c.innerHTML=i.value,c.value=i.value):(c.setAttribute("value",i.value),c.value=i.value))});let e=o.querySelectorAll("select"),p=l.querySelectorAll("select");e.forEach((i,f)=>{let c=p[f];if(c){c.value=i.value;let d=c.querySelector(`option[value="${i.value}"]`);d&&d.setAttribute("selected","true")}});let n=o.querySelectorAll("input[type=checkbox], input[type=radio]"),r=l.querySelectorAll("input[type=checkbox], input[type=radio]"),u=Math.random().toString(36).substring(7);n.forEach((i,f)=>{let c=r[f],d=i;c&&(d.type==="radio"&&d.name&&(c.name=`${d.name}__pdf_${u}`),c.checked=d.checked,d.checked&&c.setAttribute("checked","checked"))})}function k(o,l){let a=o.querySelectorAll("canvas"),t=l.querySelectorAll("canvas");a.forEach((e,p)=>{let n=t[p];if(n)try{if(e.width>0&&e.height>0){n.width=e.width,n.height=e.height;let r=n.getContext("2d");r&&r.drawImage(e,0,0)}}catch(r){console.warn("[html-img-pdf] Failed to copy canvas:",r)}})}function N(o,l){let a=o.querySelectorAll("video"),t=l.querySelectorAll("video");a.forEach((e,p)=>{let n=t[p];if(n&&!(e.readyState<2))try{let r=document.createElement("canvas");r.width=e.videoWidth||e.clientWidth,r.height=e.videoHeight||e.clientHeight;let u=r.getContext("2d");if(u){u.drawImage(e,0,0,r.width,r.height);let i=document.createElement("img");i.src=r.toDataURL("image/png"),i.style.cssText="width:100%; height:100%; object-fit:contain;",n.parentNode&&n.parentNode.replaceChild(i,n)}}catch{}})}function $(o){o.querySelectorAll("*").forEach(a=>{let t=window.getComputedStyle(a);if(["auto","scroll"].includes(t.overflowY)||["auto","scroll"].includes(t.overflow)){let e=a;e.style.setProperty("overflow","visible","important"),e.style.setProperty("overflow-y","visible","important"),e.style.setProperty("height","auto","important"),e.style.setProperty("max-height","none","important")}})}function H(o,l){let a=document.createElement("div"),t=window.getComputedStyle(document.body);a.style.cssText=`
    position: absolute; 
    top: -10000px; 
    left: -10000px;
    opacity: 0;
    pointer-events: none;
    width: ${o.clientWidth}px; 
    font-family: ${t.fontFamily};
    font-size: ${t.fontSize};
    color: ${t.color};
    line-height: ${t.lineHeight};
    text-align: ${t.textAlign};
    z-index: -999999;
  `;let e=o.cloneNode(!0);a.appendChild(e),document.body.appendChild(a);try{R(o,e),k(o,e),N(o,e),$(e),l&&l(e)}catch(p){console.error("[html-img-pdf] Clone enhancement error:",p)}return{sandbox:a,clone:e}}function M(o){document.body.contains(o)&&document.body.removeChild(o)}async function b(o){try{await document.fonts.ready}catch{}let a=Array.from(o.querySelectorAll("img")).map(t=>(t.getAttribute("loading")==="lazy"&&t.setAttribute("loading","eager"),t.complete||!t.src?Promise.resolve():new Promise(e=>{t.onload=()=>e(),t.onerror=()=>e(),setTimeout(()=>e(),2e3)})));await Promise.all(a),await new Promise(t=>setTimeout(t,100))}import{toPng as L,toJpeg as C}from"html-to-image";var S=15e3;async function A(o,l){let{format:a,quality:t,backgroundColor:e,pixelRatio:p}=l,n=o.offsetWidth,r=o.offsetHeight;if(n===0||r===0)return null;if(n>S||r>S)return console.error(`[html-img-pdf] Element too large (${n}x${r}). Skipped to prevent crash.`),null;let u={quality:t,backgroundColor:e,pixelRatio:p,width:n,height:r,cacheBust:!0,style:{margin:"0",transform:"none"}};try{let i;try{a==="png"?i=await L(o,u):i=await C(o,u)}catch(f){if(p>1)console.warn("[html-img-pdf] High-res capture failed, retrying with 1x ratio..."),u.pixelRatio=1,a==="png"?i=await L(o,u):i=await C(o,u);else throw f}return{dataUrl:i,width:n,height:r}}catch(i){return console.error("[html-img-pdf] Capture failed:",i),null}}async function F(o,l){let a=[];for(let t=0;t<o.length;t+=l){let e=o.slice(t,t+l),p=await Promise.all(e.map(n=>n()));a.push(...p)}return a}async function X(o,l={}){let{fileName:a="document.pdf",imageFormat:t="png",quality:e=.95,backgroundColor:p="#ffffff",pageSize:n="auto",pageOrientation:r,multipage:u=!1,pixelRatio:i=window.devicePixelRatio||2,concurrency:f=3,onClone:c}=l,{sandbox:d,clone:E}=H(o,c);try{await b(E);let h=[];u?(h=Array.from(E.children).filter(s=>s.nodeType===Node.ELEMENT_NODE),h.length===0&&(h=[E])):h=[E];let P=h.map(s=>()=>A(s,{format:t,quality:e,backgroundColor:p,pixelRatio:i})),T=(await F(P,f)).filter(s=>s!==null);if(T.length===0)return console.warn("[html-img-pdf] No content captured."),new w;let m=null;for(let s of T)if(n==="auto"){let y=r==="portrait"||r==="landscape"?r==="portrait"?"p":"l":s.width>s.height?"l":"p",g=[s.width,s.height];m?m.addPage(g,y):m=new w({orientation:y,unit:"px",format:g}),m.addImage(s.dataUrl,t.toUpperCase(),0,0,s.width,s.height)}else{let y=r||"portrait",g;y==="auto"?g=s.width>s.height?"l":"p":g=y==="landscape"?"l":"p";let x=typeof n=="string"?n:[n.width,n.height];m?m.addPage(x,g):m=new w({orientation:g,unit:"pt",format:x});let v=m.internal.pageSize.getWidth(),q=v/s.width,I=s.height*q;m.addImage(s.dataUrl,t.toUpperCase(),0,0,v,I)}return m.save(a),m}catch(h){throw console.error("[html-img-pdf] Export failed:",h),h}finally{M(d)}}export{X as htmlToPdf};
//# sourceMappingURL=index.mjs.map